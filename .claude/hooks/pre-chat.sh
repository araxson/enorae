#!/bin/bash

# Claude Code Pre-Chat Hook
# This hook ensures Claude reads ALL critical project documentation before starting any work

set -e

PROJECT_ROOT="/Users/afshin/Desktop/Enorae"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸš¨ MANDATORY DOCUMENTATION READING - ENORAE PROJECT"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Generate fresh project tree
echo "ğŸŒ³ Step 1: Generating fresh project tree..."
if python3 "$PROJECT_ROOT/scripts/generate-project-tree.py" 2>/dev/null; then
    echo "   âœ… Project tree generated: docs/PROJECT_TREE.md"
else
    echo "   âš ï¸  Warning: Failed to generate project tree"
fi
echo ""

echo "âš ï¸  You MUST read ALL of the following documents before proceeding:"
echo ""

# Core Documentation
echo "ğŸ“‹ CORE DOCUMENTATION (MANDATORY):"
echo "   1. âœ… CLAUDE.md - AI Development Guidelines (13KB)"
echo "   2. âœ… README.md - Project Overview (9KB)"
echo "   3. âœ… docs/index.md - Documentation Index (15KB)"
echo "   4. âœ… docs/PROJECT_TREE.md - Current Project Structure (auto-generated)"
echo ""

# Architecture Documentation
echo "ğŸ—ï¸  ARCHITECTURE DOCUMENTATION (MANDATORY):"
echo "   5. âœ… docs/02-architecture/overview.md (28KB)"
echo "      - Why single app, database analysis, design decisions"
echo "   6. âœ… docs/02-architecture/project-structure.md (51KB)"
echo "      - Complete file tree, all routes, all features"
echo "   7. âœ… docs/02-architecture/roles-and-routing.md (12KB)"
echo "      - 11 roles, 4 portals, middleware, auth flow"
echo "   8. âœ… docs/02-architecture/naming-conventions.md (20KB)"
echo "      - File/folder naming rules, 10 patterns, examples"
echo ""

# Database Documentation
echo "ğŸ—„ï¸  DATABASE DOCUMENTATION (MANDATORY):"
echo "   9. âœ… docs/03-database/schema-overview.md (9KB)"
echo "      - 42 tables, 108 functions, 8 schemas breakdown"
echo "   10. âœ… docs/03-database/detailed-analysis.md (12KB)"
echo "      - Deep audit, critical findings, health score"
echo "   11. âœ… docs/03-database/best-practices.md (22KB)"
echo "      - RLS performance (94% faster), query optimization"
echo ""

# Frontend Documentation
echo "ğŸ¨ FRONTEND DOCUMENTATION (MANDATORY):"
echo "   12. âœ… docs/04-frontend/component-patterns.md (~25KB)"
echo "      - DAL pattern, type safety, component patterns"
echo "   13. âœ… docs/04-frontend/state-and-performance.md (~8KB)"
echo "      - State management, performance optimization"
echo "   14. âœ… docs/04-frontend/error-handling-and-testing.md (~7KB)"
echo "      - Error handling, testing strategies"
echo "   15. âœ… docs/04-frontend/reference.md (~8KB)"
echo "      - Quick reference, conventions, checklist"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âš ï¸  CRITICAL RULES - ZERO TOLERANCE:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… MUST DO:"
echo "   â€¢ Query from public views ONLY (not schema.table)"
echo "   â€¢ Use Database['public']['Views'] for types"
echo "   â€¢ Add 'server-only' directive in ALL DAL files"
echo "   â€¢ Check auth in EVERY DAL function"
echo "   â€¢ Wrap auth.uid() in (select ...) for 94% faster RLS"
echo "   â€¢ Use kebab-case for all file names"
echo "   â€¢ Use shadcn/ui components ONLY"
echo "   â€¢ Add explicit filters (.eq('user_id', user.id))"
echo ""
echo "âŒ NEVER DO:"
echo "   â€¢ Create or modify database tables/schema"
echo "   â€¢ Query schema tables directly (.schema('...'))"
echo "   â€¢ Use Tables types (use Views types)"
echo "   â€¢ Create custom UI primitives"
echo "   â€¢ Use 'any' types"
echo "   â€¢ Skip auth checks in DAL"
echo "   â€¢ Create files with -v2, -new, -fixed suffixes"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š PROJECT QUICK REFERENCE:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Database:   42 tables, 108 functions, 10 public views"
echo "Schema:     8 business domains (organization, catalog, scheduling, etc.)"
echo "Roles:      11 roles (super_admin â†’ guest)"
echo "Portals:    4 route groups (marketing, customer, staff, business, admin)"
echo "Features:   19 feature modules"
echo "Tech:       Next.js 15, React 19, TypeScript 5.6, Supabase, shadcn/ui"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ FILE NAMING QUICK REFERENCE:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Folders:    kebab-case/"
echo "Components: kebab-case.tsx         (salon-card.tsx)"
echo "DAL:        [feature].queries.ts   (salon.queries.ts)"
echo "Actions:    [feature].actions.ts   (salon.actions.ts)"
echo "Types:      [feature].types.ts     (salon.types.ts)"
echo "Hooks:      use-[name].ts          (use-salon.ts)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ¯ BEFORE YOU START:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. âœ… Have you read ALL 15 documentation files?"
echo "2. âœ… Have you reviewed the PROJECT_TREE.md (current structure)?"
echo "3. âœ… Do you understand the public views pattern?"
echo "4. âœ… Do you know the 11 roles and 4 portals?"
echo "5. âœ… Are you clear on naming conventions?"
echo "6. âœ… Do you know the RLS performance patterns?"
echo "7. âœ… Have you reviewed the DAL pattern?"
echo ""
echo "If you answered NO to any of these, STOP and read the docs!"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… DOCUMENTATION READING COMPLETE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "You may now proceed with your task."
echo "Total documentation: ~210KB across 15 files (including fresh PROJECT_TREE.md)"
echo ""
echo "ğŸ’¡ TIP: Keep docs/index.md and docs/PROJECT_TREE.md open for reference"
echo ""
